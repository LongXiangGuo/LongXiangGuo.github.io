---
layout: default
title: How to Setup iOS in a Flutter Project
parent: Recipes
nav_order: 2
---

# How to Setup iOS in a Flutter Project

If you want to build a new Flutter project, or if you wish to update the native code on an existing Flutter project, this is the guide for you!

## New Flutter Project

At BMW, we use Kotlin for Android and Swift for iOS, so you will only need to use this one command:

```bash
flutter create -i swift {your_project_name}
```

Whenever you support new features that require device permissions, you'll need to add permissions in your **Info.plist**.

## Recreating an Existing Flutter Project

If your Android or iOS project stop working appropriately, or you can't generate release candidate builds using command line tools, you may need to recreate the native projects. Sometimes it'd be quicker to start over than try to salvage the existing code, as we can re-use files such as the **\*.plist**'s or configuration files.

Before attempting this, please check if your issue is solved with newer versions of the Flutter iOS or Android tools.

Before attempting this, you should check if the **Podfile** has been updated in a newer version of Flutter. Perhaps you'll only need to copy the latest CocoaPod script into the project, and run `pod install` from the `ios/` directory. If that doesn't fix it, proceed to the next step.

### Required Changes for a New iOS Project

Move the `ios/` folder outside of the project. Then run the same script as in **New Flutter Project** from a different directory, and copy the new `ios/` folder into the project.

**Note:** For any files that aren't auto-generated by Flutter, you need to add a reference to these files in XCode. This includes files that you copy over from a previous iOS project.

These files are required:

* **\*.xcscheme**
  * **_These need to be created from scratch in XCode_**
  * Custom schemes are needed when working with flavors, you'll need 1 scheme per Flutter flavor
  * The scheme's name should be **{flutter_flavor_in_lowercase}**
  * You **must** check the "Shared" box on the right-hand side of the Manage Schemes page for every new scheme
    * If not, it will be ignored by Git
  * Build / Test / Analyze should use the **Debug** project configuration
  * Profile/Archive should use the **Release** project configuration
* Project Configurations
  * **_These need to be manually added to the Runner Project_**
  * The name should be **"{Debug/Release}-{flutter_flavor_in_lowercase}**"
  * 2 of these are needed per flavor, one each for **Debug** and **Release**
  * If you're using custom **\*.xcconfig**'s, the names should be identical
* Custom **\*.xcconfig**'s
  * **_DO NOT create a custom \*.xcconfig per flavor.**
  * Flutter no longer creates projects with CocoaPods, so doing this isn't very useful
    * Any custom compile-time environment variables can be set in the flavor's `*plist` file
  * **FLUTTER_TARGET** will be set in the Target build settings
* **Podfile**
  * If you are using custom **\*.xcconfig**'s, you'll need to add the configurations here under the script for the Runner Project
* **AppDelegate.swift**
  * If you have custom logic in the previous iOS project, you can copy it back to the new file
* Other custom configurations
  * If you're managing API keys in a secrets file, you may need to copy the old secrets from the previous iOS project

You'll also need to tweak these project settings in XCode:

* Runner Project Info Settings
  * iOS Deployment Target
    * A lot of apps adopt an `n - 1` or `n - 2` approach, so this is also where you specify the minimum supported iOS version for business reasons
    * If the former doesn't apply, you may only need to do this if your project requires a higher version of iOS
      * e.g., Swift APIs requiring 11.0 or higher, such as Face ID
* Runner Target Build Settings
  * Asset Catalog App Icon Set Name
    * For each Project Configuration, you'll need to point it to the appropriate App Icon set
  * Info.plist File
    * For each Project Configuration, you'll need to point it to the appropriate `*.plist` file
  * FLUTTER_TARGET
    * For each Project Configuration, you'll need to point it to the appropriate `lib/path_to_flavor_main.dart` so it won't be overridden by Flutter's run/build tools
      * This allows the project to build seamlessly from XCode, VS Code, or Flutter CLI

### Setting up Bundle Identifiers

After setting up a `*.plist` for each flavor as in the previous steps, make these changes:

* Flavor-Specific `*.plist` Files
  * Override the **CFBUNDLEIDENTIFIER** value with whatever bundle identifier you wish for that flavor

## Troubleshooting an iOS Project

### Common Build Errors & Solutions:

* `Undefined symbol: _OBJC_CLASS_$_FlutterAppDelegate`
  * This may indicate that a library is referencing an iOS API higher than your iOS Deployment Target, or you may just need to update your CocoaPod dependencies
  * Solution:
    1. First, try going into the `ios/` directory and running `pod install`, then try again
    2. If that doesn't work, update the iOS Deployment Target as necessary
* XCode console:

  ```bash
  "error: use of unresolved identifier 'GeneratedPluginRegistrant'
        GeneratedPluginRegistrant.register(with: self)"
  ```

  * The Objective-C Bridging Header may not be referenced in the Runner Target Build Settings
  * Please consult the section on **Custom \*.xcconfig's**
* XCode console:

  ```bash
  fatal error:
      'flutter_secure_storage/FlutterSecureStoragePlugin.h' file not found
  ```

  * Try going into the `ios/` directory and running `pod install`, then try again
* (Simulator) XCode Build passes, but there's an error dialog saying "This app could not be installed at this time"
  * In the simulator, go into "Hardware" > "Erase all Content and Settings..." and try again

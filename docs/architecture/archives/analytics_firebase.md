---
layout: default
title: Analytics - Google Firebase
parent: Archives
nav_order: 3
grand_parent: Architecture
---

# Analytics - Google Firebase

{: .no_toc }

## Table of contents

{: .no_toc .text-delta }

1. TOC
{:toc}

## Firebase Analytics

The [Firebase Analytics Flutter Package](https://pub.dartlang.org/packages/firebase_analytics) is recommended to track analytics data generated by the client.  It provides an observer (FirebaseAnalyticsObserver) that can be passed to the MaterialApp’s navigatorObserver property. The observer automatically logs page routing information which can then be visualized to show which screens are more actively viewed by the users. While the data is collected and visualized in the Firebase Events Dashboard it can also be exported to Big Query for further export into the preferred BMW Analytics system.

## PoC - Google Analytics

The PoC is broken into three parts, Client SDK, Dashboard, Data Exporting

### Client SDK – Firebase Analytics

* PoC repo can be found [here](https://code.connected.bmw/mobile20/mobile-POCs/tree/master/poc_analytics)

* Google provides [Firebase Analytics for Flutter package](https://pub.dartlang.org/packages/firebase_analytics) and integrating the SDK is as simple as adding it to the pubspec.yaml.

* The [GitHubRepo](https://github.com/flutter/plugins/tree/master/packages/firebase_analytics) contains the package source code and example code for creating a FirebaseAnalytics object and a FirebaseAnalyticsObserver for beginning the process of logging analytics.

* FirebaseAnalyticsObserver can be passed to the MaterialApp's navigatorObserver property.  This will allow the observer to automatically log routing, assuming route names are defined.  This information can then be visualized to show which screens are more actively viewed by the user base in the Firebase Events Dashboard.  

* The Analytics object provides the interfaces for logging general or specific analytics.  For example, an interface for logging that the user has logged in is supported rather than our creating a specific one.  It also supports a logEvent interface that allows the developer to pass an event name and a dictionary of name/value pairs.

* Google hasn't updated the Firebase documentation to include Flutter so the links below are API references for Swift and Android:
  * [Swift reference](https://firebase.google.com/docs/reference/swift/firebaseanalytics/api/reference/Classes/Analytics)
  * [Android reference](https://firebase.google.com/docs/reference/android/com/google/firebase/analytics/package-summary)

### What does Firebase provide out of the box?

* [Automatically Collects Events](https://support.google.com/analytics/answer/6317485?hl=en&ref_topic=6317484) like capturing the name of the screen the user sees when using the app
* [Provides Standard Events](https://support.google.com/analytics/answer/6317498?hl=en&ref_topic=6317484) to log events like login without creating a custom event ourselves

#### Firebase Analytics Dashboard

![Dashboard]({{site.baseurl}}/assets/images/firebase_main_dashboard.png)

* Google provides documentation around the use of their dashboard and I'll provide a link for that here.  The Dashboard is broken up into:
  * Active User Breakdown
  * Users in last 30 minutes
  * Top conversion events
  * Daily User Engagement
  * Revenue
  * App Stability
  * User Adoption
  * Latest Release
  * New User acquisition
  * User retention
  * Global Audience Demographic.

* Other Analytics reports you can get are around:
  * Events, Conversions
  * Audiences
  * Funnels
  * User Properties
  * Latest Release
  * Retention
  * StreamView
  * DebugView

* The reports with immediate relevancy are probably Events, Conversions, Funnels and User Properties.  I spent a fair amount of time with events and funnels and found we can get some interesting data out of those reports.  For example, from events, clicking the screen_view event and changing to the screen name in that graph, you can see a report on which screens the users have visited in the last 30 minutes.  Funnels provide a way of understanding for a specific user flow

![Event Dashboard]({{site.baseurl}}/assets/images/firebase_event_dashboard.png)

### Data Exporting

* Google's BigQuery service provides data import, visualization, querying and export.  It is the means to export the raw analytics data collected by Firebase.

* BigQuery requires that the associated Firebase project is on the Blaze service plan, which is a pay-as-you-go plan. Pricing can be found in the sub-bullet below.
  * [Big Query Pricing](https://cloud.google.com/bigquery/pricing)
  * Data import and export are free, but storage of the data is subject to the pricing included in the above link
  * Querying data is at $5 per TB

* The data can be exported as CSV or JSON file to Google Cloud Storage.  Pricing will affect the size of the file on export.  You can then write a job to transfer this data to another service or download the raw data to your local machine.

* The [PoC](https://code.connected.bmw/mobile20/mobile-POCs/tree/master/poc_analytics) project is now writing data to a Firebase project that is linked to Big Query.  To see the data and export the data do the following:

1. Run the PoC app to generate data to view
2. Login using the [Team Google account](http://suus0001.w10:8090/display/MS2/Credentials)
3. Go to the [Firebase console](https://console.firebase.google.com/project/btcpocanalytics/analytics/app/ios:com.bmw.poc.analytics/events~2Foverview%3Ft=1&cs=app.m.events.overview&g=1)for the project and select "Events"
4. At the bottom of that page click "View".  This should take you to the BigQuery view.
5. Click Export Table and fill in the following URL for the Google Cloud Storage URI -- gs://btcpocanalytics.appspot.com/exported_data/<filename>.  See image below
6. Click on View Files in that same dialog and navigate to the directory where you stored the file.  Right click and do a Save Link As, you'll now have the raw analytics data in a CSV or JSON file format.

![Image of BigQuery Export]({{site.baseurl}}/assets/images/big_query_screenshot.png)

* Google provides the [following APIs](https://developers.google.com/analytics/devguides/reporting/) for automating report queries.  However, none pertain to exporting raw data to another service.  This is done via BigQuery

### Google Services in China

* While Google Analytics may be available in China, Firebase as a service on top of it may be blocked

* [Stack Overflow statement on Google China Services from 8/5/2018](https://stackoverflow.com/questions/42605566/can-firebase-be-used-as-a-realtime-database-in-china-now/42620514#42620514)

* Google services, which includes Firebase, are blocked in China making this solution not workable when running China flavors of the app

* If the analytics solution is wrapped by a generic enough interface, we could use Firebase in NA & ROW and let the China team add in an acceptable SDK solution for China.  If Firebase becomes available in the future, it can be utilized at that point.
